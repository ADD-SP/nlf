name: Release

on:
  release:
    types: [created]

jobs:
  release:
    name: Release - ${{ matrix.target }}
    strategy:
      matrix:
        include:
          - runs-on: ubuntu-latest
            target: aarch64-apple-darwin

          - runs-on: ubuntu-latest
            target: aarch64-unknown-linux-gnu

          - runs-on: ubuntu-latest
            target: aarch64-unknown-linux-musl

          - runs-on: ubuntu-latest
            target: x86_64-apple-darwin

          - runs-on: ubuntu-latest
            target: x86_64-unknown-linux-gnu

          - runs-on: ubuntu-latest
            target: x86_64-unknown-linux-musl

    runs-on: ${{ matrix.runs-on }}

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Build binary
        uses: houseabsolute/actions-rust-cross@e10d0dcde72fe30fbc0912ddec9c57c070a16529 # v1.0.1
        with:
          target: ${{ matrix.target }}
          args: "--locked --profile release-small"
          strip: true

      - name: Publish artifacts and release
        uses: houseabsolute/actions-rust-release@20a9c560fd471683ae9ebb8247eecb9a8ae5d21c # v0.0.5
        with:
          executable-name: nlf
          target: ${{ matrix.target }}
